var Actions={init:function(){this.onShow()},onShow:function(){if(User.data){$('.menu_button_login').hide()}else{$('.menu_button_login').show()}},};var Arbitrage={init:function(){var that=this;that.onShow()},onShow:function(){var that=this;that.updateList()},checkInvitation:function(){B.get({Expert:'check_invitation'})},offerToExpert:function(input){var that=this;if($('.dialog').is(':visible')){setTimeout(function(){that.offerToExpert(input)},500)}else{D.show({title:{'you_has_been_invited_as_an_expert2':{en:'Would you like to participate as an expert in the dispute of the parties?',ru:'Хотите принять участие в качестве эксперта в споре сторон?'}},buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){A.w(['Site'],function(){Site.switchTo('arbitrage')})}}},message:!1,css:D.getCSS({type:'norm'})})}},controlRoyalty:function(id,init,max){var that=this;if(init){if($('.expert_royalty').is(':visible')){$('.expert_royalty').attr({max:max}).unbind('mouseup').mouseup(function(){that.controlRoyalty(id)}).unbind('keyup').keyup(function(){that.controlRoyalty(id)}).unbind('change').change(function(){that.controlRoyalty(id)})}else{setTimeout(function(){that.controlRoyalty(id,init,max)},200);return !1}}
if($('.expert_royalty').val()||$('.expert_royalty').val()===0){if($('.expert_royalty').val()*1>$('.expert_royalty').attr('max')*1){$('.expert_royalty').val($('.expert_royalty').attr('max'))}
B.click($('.button_ok').css({opacity:1,cursor:'pointer'}),function(){D.hide();B.post({Expert:'expert_agree',id:id,price:$('.expert_royalty').val()*1})})}else{$('.button_ok').css({opacity:0.5,cursor:'default'}).unbind('click')}},showLimits:function(input){var that=this;if(!User||!User.data){setTimeout(function(){that.showLimits(input)},200);return}
for(var i in input.data){var record=input.data[i];var iam=User.data.id==record.user_id?'seller':'customer';$('.can_decline_experts.id_'+i).html(record[iam+'_declines']);$('.can_invite_experts.id_'+i).html(record.can_invite)}},outBalanceClaims:function(input){var that=this;if(input.data){$('.balance_dispute_host').slideDown();$('.balance_claims_host').html(input.html);$('.balance_claims_host .help_line').css({'min-width':'10px'});A.w(['User'],function(){that.showLimits(input);B.click($('.balance_claims_host .decline_this_expert'),function(obj){D.hide(function(){D.show({title:{sure_to_declie_this_expert:{en:'Are you sure to decline this expert?',ru:'Вы уверены что хотите отказаться от этого эксперта?'}},message:!1,buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){B.post({Expert:'decline_this_expert',id:B.getID(obj)})}}},css:D.getCSS({type:'no'})})})});B.click($('.accept_this_expert'),function(obj){D.hide(function(){D.show({title:{sure_to_accept_this_expert2:{en:'Are you sure to accept this expert and pay amount requested by expert?',ru:'Вы уверены что признаете этого эксперта и готовы оплатить запрашиваемую экспертом сумму?'}},message:'pages/arbitrage/expert_royalty_conditions.php',buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){B.post({Expert:'accept_this_expert',id:B.getID(obj)})}}},css:D.getCSS({type:'ok'})})})});B.click($('.invite_expert'),function(obj){var id=B.getId(obj);D.show({title:{invite_expert:{en:'Find and invite expert',ru:'Найти и пригласить эксперта'}},cls:'dialog-invite',message:'pages/arbitrage/invite.php',onShow:function(){var callback=function(){that.runSearch({page:0,claim_id:id})};that.controlSearchExpert(callback);$('.expert_name').unbind('mouseup').mouseup(function(){that.controlSearchExpert(callback)}).unbind('keyup').keyup(function(){that.controlSearchExpert(callback)}).unbind('change').change(function(){that.controlSearchExpert(callback)});B.get({Expert:'create_invitation',claim_id:id,ok:function(response){$('.expert_invitation_link').val(response.link)}})}})});B.click($('.cancel_chargeback'),function(obj){var claim_id=B.getId(obj);if(input.data){var iam=input.data[claim_id].user_id==User.data.id?'seller':'customer'}else{var iam=!1}
D.show({title:{are_you_sure_to_agree_claim_and_continue_transaction:{en:'Are you sure to accept the claim of your contragent?',ru:'Вы уверены что согласны с претензией контрагента? '}},message:'pages/arbitrage/warning.php?iam='+iam,css:D.getCss({type:'no'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Offer:'cancel_chargeback',offer_id:claim_id})}}}})})});$('.viewUser').unbind('click').click(function(){B.get({User:'view',user_id:B.getID($(this)),offer_id:B.getID($(this),'offer_id_')})});B.click($('.deal_admit_claim'),function(obj){D.show({title:{'sure_to_admit_claim (in confirmation)':{en:'Are you sure to admit a claim?',ru:'Вы уверены что призанете претензию?'}},message:'pages/deal/admit_confirmation.php?role='+($('.customer_page').is('visible')?'customer':'seller'),css:D.getCSS({type:'no'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'admit',id:B.getID(obj)})}}}})});Site.contextHelpProcessor($('.balance_claims_host'))}else{console.log(input);$('.balance_dispute_host').slideDown();$('.balance_claims_host').html(input.html);$('.balance_claims_host .help_line').css({'min-width':'100%'})}
if(input.expertise){$('.claims_on_expertise').html(input.expertise);B.click($('.claims_on_expertise .vote_dispute'),function(obj){var side=B.getID(obj,'for_');var id=B.getID(obj,'id_');D.hide(function(){D.show({title:side==(obj.hasClass('isDeal')?'customer':'seller')?{vote_for_seller:{en:'Are you sure that Seller is right?',ru:'Вы уверены что прав Продавец?'}}:{vote_for_customer:{en:'Are you sure that Customer is right?',ru:'Вы уверены что прав Покупатель?'}},buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Expert:'vote',side:side,id:id})}}},message:!1,css:D.getCSS({type:'norm'})})})});B.click($('.claims_on_expertise .agree_to_act_as_expert'),function(obj){B.get({Expert:'showExpertFeeForm',id:B.getID(obj)})});B.click($('.claims_on_expertise .decline_this_expert'),function(obj){D.hide(function(){D.show({title:{sure_to_expert_disagree_57:{en:'You sure you don`t want to pursue the expertise of the dispute?',ru:'Вы уверены что не хотите проводить экспертизу данного спора?'}},buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){B.post({Expert:'expert_disagree',id:B.getID(obj)})}}},message:!1,css:D.getCSS({type:'no'})})})});$('.viewUser').unbind('click').click(function(){B.get({User:'view',user_id:B.getID($(this)),offer_id:B.getID($(this),'offer_id_')})});$('.expertise_host').slideDown();Site.contextHelpProcessor($('.claims_on_expertise'))}else{$('.claims_on_expertise').html('');$('.expertise_host').slideUp()}
Site.initImages({onExit:function(){D.hide()},onDelete:function(){},get:{}})},showExpertFeeForm:function(input){var that=this;D.hide(function(){D.show({title:{are_you_agree_to_act_as_expert_for3:{en:'Are you ready to act as expert on the disputed transaction for <span class="expert_royalty_host">{{text}}</span>$?',ru:'Вы готовы выступить экспертом по спорной сделке за <span class="expert_royalty_host">{{text}}</span>$?',_include:{text:'<input type="text" class="expert_royalty" placeholder="" min="0" max="100" style="font-size:0.7rem; width:50px;"/>'}}},buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){}}},onShow:function(){that.controlRoyalty(input.id,!0,input.max)},css:D.getCSS({type:'norm'})})})},runSearch:function(input){var page=input.page;var that=this;B.get({Expert:'search',claim_id:input.claim_id,page:page,what:$('.invite_expert_host .expert_name').val(),ok:function(response){$('.experts_list').html(response.html);$('.pagination_host').html(response.pagination);if(response.html){$('.experts_list_host').slideDown()}else{$('.experts_list_host').slideUp();return}
$('.invite_expert_host .pagination').unbind('click').click(function(){that.runSearch({page:B.getId($(this)),claim_id:input.claim_id})});B.click($('.invite_expert_host .list_user_profile'),function(obj){B.post({Expert:'invite',user_id:B.getId(obj),claim_id:input.claim_id})})}})},controlSearchExpert:function(callback){if($('.expert_name').val()){B.click($('.search_expert').css({opacity:1,cursor:'pointer'}),function(obj){callback()});if($('.expert_name').val().indexOf('@')!==-1){$('.send_expert_invitation').css({opacity:1,cursor:'pointer'}).unbind('click').click(function(){})}else{$('.send_expert_invitation').css({opacity:0.5,cursor:'default'}).unbind('click')}}else{$('.search_expert').css({opacity:0.5,cursor:'default'}).unbind('click');$('.send_expert_invitation').css({opacity:0.5,cursor:'default'}).unbind('click')}},updateList:function(input){if($('.arbitrage_page').is(':visible')){A.w(['D','B'],function(){D.hide();B.get({Offer:'get_claims'})});$('.indicator_arbitrage').hide()}else if(input&&input.notification){$('.indicator_arbitrage').fadeOut(function(){$('.indicator_arbitrage').show()})}}};var Withdraw={init:function(){Balance.init()}};var Balance={onShow:function(){this.updateWithdraw()},updateWithdraw:function(input){if($('.withdraw_page').is(':visible')){B.get({r:'user/main',Offer:'my_withdrawal_requests'});$('.indicator_withdraw').hide()}else if(input&&input.notification=='seller'){$('.indicator_withdraw').fadeOut(function(){$('.indicator_withdraw').show()})}
if($('.balance_page').is(':visible')){B.get({r:'user/main',Offer:'get_accepted'});$('.indicator_fillup').hide()}else if(input&&input.notification=='customer'){$('.indicator_fillup').fadeOut(function(){$('.indicator_fillup').show()})}},init:function(){var that=this;$('.fill_balance_amount').unbind('change').change(function(){that.control()}).unbind('keyup').keyup(function(){that.control()}).unbind('mouseup').mouseup(function(){that.control()});that.control();this.getWithdrawalMethods();this.onShow()},outputWithdrawalMethods:function(input){var that=this;$('.withdrawal_methods_host').html(input.html);$('.withdraw_amount').unbind('change').change(function(){that.control()}).unbind('keyup').keyup(function(){that.control()}).unbind('mouseup').mouseup(function(){that.control()});that.control()},loadUserPaymentMethod:function(input){$('.user_payment_method_id').val(input.id);$('.payment_type_details').val(input.mode=='automatic'?'':input.description);$('.payment_type_default').val(input.description);$('.payment_page_url').val(input.mode=='automatic'?input.description:'');if(input&&input.mode=='automatic'){$('.manual_payment_host').hide();$('.automatic_payment_host').show();$('.automatic_payment').prop({checked:!0})}else{$('.manual_payment_host').show();$('.automatic_payment_host').hide();$('.manual_payment').prop({checked:!0})}
B.click($('.remove_payment_method'),function(){B.post({UserPaymentMethod:'delete',id:$('.user_payment_method_id').val()})})},editWithdrowalMethod:function(input){var that=this;D.show({title:input.title,message:'pages/dialogs/withdrawal.php?payment_id='+input.payment.payment_id,css:D.getCss({type:'norm'}),buttons:{save:{image:A.baseURL()+'images/go.png',action:function(){}}},onShow:function(){$('.payment_method_id').val(input.payment.payment_id);$('.withdraw_price').val('');$('.withdraw_amount_correction').val($('.withdraw_amount').val());that.loadUserPaymentMethod(input.userMethod);if(!input.payment.currency){$('.withdraw_nominal').hide();console.error('Need to set up currency')}
$('.auto_manual').unbind('click').click(function(){if($('.manual_payment').is(':checked')){$('.manual_payment_host').show();$('.automatic_payment_host').hide()}else{$('.manual_payment_host').hide();$('.automatic_payment_host').show()}});if(input.userMethodsIDS){var h=[];var count=0;for(var i in input.userMethodsIDS){h.push('<input type="radio" class="load_userpayment" name="all_methods" style="width:20px;" value="'+(input.userMethodsIDS[i])+'" '+(input.userMethodsIDS[i]==input.userMethod.id?'checked="checked"':'')+'/>');count+=1}
if(count>1){$('.available_methods_host').html(h.join(''));$('.available_methods_header').show();$('.load_userpayment').unbind('change').change(function(){if($(this).is(':checked')){B.get({UserPaymentMethod:'load',id:$(this).val()})}})}else{$('.available_methods_header').hide()}}else{$('.available_methods_header').hide()}
that.setPaymentControl($('.payment_control'));$('.goto_help').unbind('click').click(function(){var id=B.getID($(this))
A.w(['Help'],function(){Help.goto(id)})})}})},disablePaymentMethod:function(input){if(input.action=='disable'){$('.payment_method_host.withdraw.id_'+input.id).removeClass('available_method').css({opacity:$('.withdraw_amount').val()*1?0.6:0.6})}else{$('.payment_method_host.withdraw.id_'+input.id).removeClass('available_method').addClass('available_method').css({opacity:$('.withdraw_amount').val()*1?1:0.6})}},changeRequestedAmount:function(amount){$('.fill_balance_amount').val(amount.amount);this.control()},setPaymentControl:function(init){var that=this;if(init){init.unbind('change').change(function(){that.setPaymentControl()}).unbind('keyup').keyup(function(){that.setPaymentControl()}).unbind('mouseup').mouseup(function(){that.setPaymentControl()})}
B.forceToInt($('.withdraw_wait'),0,$('.withdraw_wait').attr('max')*1);B.forceToFloat($('.withdraw_amount_correction'),0,User.data.money*1);B.forceToFloat($('.withdraw_price'),0);if($('.manual_payment').is(':checked')){if($('.withdraw_wait').val()<$('.withdraw_wait').attr('min')*1){$('.withdraw_wait').css({color:'red'})}else{$('.withdraw_wait').css({color:'black'})}
$('.wt_76490').html(Math.max($('.withdraw_wait').attr('min'),$('.withdraw_wait').val()));if($('.withdraw_nominal').val()){$('.need_currency_name_reminder').hide()}else{$('.need_currency_name_reminder').show()}
if($('.read_and_understand').is(':checked')&&$('.withdraw_amount_correction').val()*1>0&&$('.withdraw_price').val()*1>0&&$('.withdraw_wait').val()*1>0&&$('.withdraw_nominal').val()&&$('.payment_type_details').val()){B.click($('.button_save').css({opacity:1,cursor:'pointer'}),function(obj){D.hide();B.post({r:'user/main',UserPaymentMethod:'set',wait:$('.withdraw_wait').val()*1,changed:$('.payment_type_details').val()!=$('.payment_type_default').val(),withdraw:$('.withdraw_amount_correction').val()*1,price:$('.withdraw_price').val()*1,payment_id:$('.payment_method_id').val(),currency:$('.withdraw_nominal').val(),description:$('.payment_type_details').val(),mode:'manual'})})}else{$('.button_save').css({opacity:0.5,cursor:'default'}).unbind('click')}}else{if($('.withdraw_nominal').val()){$('.need_currency_name_reminder').hide()}else{$('.need_currency_name_reminder').show()}
if($('.withdraw_amount_correction').val()*1>0&&$('.withdraw_price').val()*1>0&&$('.withdraw_nominal').val()&&$('.payment_page_url').val()){B.click($('.button_save').css({opacity:1,cursor:'pointer'}),function(obj){D.hide();B.post({r:'user/main',UserPaymentMethod:'set',withdraw:$('.withdraw_amount_correction').val()*1,price:$('.withdraw_price').val()*1,payment_id:$('.payment_method_id').val(),currency:$('.withdraw_nominal').val(),description:$('.payment_page_url').val(),mode:'automatic'})})}else{$('.button_save').css({opacity:0.5,cursor:'default'}).unbind('click')}}},getWithdrawalMethods:function(){var that=this;A.w(['User'],function(){if(User.data){B.get({r:'user/main',UserPaymentMethod:'get'})}else{setTimeout(function(){that.getWithdrawalMethods()},100)}})},outputOffersList:function(list){var that=this;if(list&&list.waiting){$('.my_withdraw_request').show();$('.offers_list',$('.my_withdraw_request')).html(list.waiting);B.click($('.cancel_offer',$('.withdraw_host')),function(obj){D.show({title:{are_you_sure_to_cancel_withdraw_order:{'en':'Are you sure you want to cancel the withdrawal request?','ru':'Вы уверены что хотите отменить заявку на вывод средств?'}},message:!1,css:D.getCss({type:'norm'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide(function(){B.post({r:'user/main',Offer:'cancel_by_seller',offer_id:B.getID(obj,'id_'),update_sell_board:$('.available_offers_host').is(':visible')?that.selected_payment_type:0})})}}}})})}else{$('.my_withdraw_request').hide()}
if(list&&list.accepted){$('.offers_list',$('.my_accepted_withdraw_requests').show()).html(list.accepted)}else{$('.my_accepted_withdraw_requests').hide()}
if(list&&list.confirmed){$('.offers_list',$('.my_confirmed_withdraw_requests').show()).html(list.confirmed);B.click($('.check_payment',$('.withdraw_host')),function(obj){B.post({r:'user/main',Offer:'payment_details',seller_check:1,offer_id:B.getID(obj,'id_')})})}else{$('.my_confirmed_withdraw_requests').hide()}
if(list&&list.disputed){$('.withdraw_disputed_offers_host').show();$('.withdraw_disputed_offers_list').html(list.disputed);B.click($('.cancel_chargeback'),function(obj){D.show({title:{are_you_sure_to_cancel_claim_and_continue_transaction:{en:'Are you sure to cancel the claim?',ru:'Вы уверены что снимаете претензию?'}},message:!1,css:D.getCss({type:'ok'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Offer:'cancel_chargeback',offer_id:B.getId(obj)})}}}})});B.click($('.view_claim'),function(obj){B.get({r:'user/main',Offer:'view_claim',offer_id:B.getId(obj)})})}else{$('.withdraw_disputed_offers_host').hide()}
if(list&&(list.confirmed||list.accepted||list.disputed)){that.restartRemainTimer()}
if(list&&(list.balance||list.balance===0)){User.data.money=list.balance;$('.user_balance_detector').html(User.data.money+'$')}
$('.request_line .user').unbind('click').click(function(){B.get({User:'view',user_id:B.getID($(this)),heIs:$(this).hasClass('heIsSeller')?'seller':'buyer'})})},remainTimer:!1,updateTime:!1,restartRemainTimer:function(){clearTimeout(this.remainTimer);this.remainTimer=!1;this.updateTime=Date.now()/1000;var same={};$('.time_remain2').each(function(){var id=B.getId($(this));if(same[id]){if(same[id].attr('timestamp')*1<$(this).attr('timestamp')*1){var min=same[id].attr('timestamp')*1}else{var min=$(this).attr('timestamp')*1}
$('.time_remain.id_'+id).attr({timestamp:min})}else{same[id]=$(this)}});this.showRemainTime()},alreadyUpdated:{},showRemainTime:function(){var that=this;var pass=Date.now()/1000-that.updateTime;$('.time_remain2').each(function(){var timestamp=$(this).attr('timestamp')*1-pass;if(timestamp<0){var id=B.getID($(this));if(!that.alreadyUpdated[id]){that.updateWithdraw();that.alreadyUpdated[id]=!0}
$('.request_line.id_'+id).hide();if($('.time_remain.id_'+id,$('.time_remain_host')).is(':visible')){D.hide()}}else{var date=new Date(timestamp*1000);$(this).html(('0'+(date.getUTCHours()+date.getUTCDay()*24)).slice(-2)+':'+('0'+date.getUTCMinutes()).slice(-2)+':'+('0'+date.getUTCSeconds()).slice(-2))}});that.remainTimer=setTimeout(function(){that.showRemainTime()},1000)},withdraw_methods:{},getWithdraw_methods:function(){var that=this;var result=[];for(var i in that.withdraw_methods){if(that.withdraw_methods[i]){result.push(i)}}
return result},showChargeBackDialog:function(input){var that=this;B.get({r:'user/main',Offer:'get_chargeback',offer_id:input.offer_id,ok:function(response){D.show({title:input.isCounter?{'Are you sure to run counterclaim':{en:'You disagree with the claim and want to put a counter claim?',ru:'Вы не согласны с претензией и хотите выставить встречную?'}}:{'sure_to_run_cahellenge':{en:'Are you sure to run challenge deal mechanism?',ru:'Вы уверены что хотите запустить процедуру отмены сделки?'}},exit:input.onExit?function(){input.onExit()}:!1,onShow:function(){$('.chargeback_host').html(response.html);Site.restoreFormParameters(input.obj?input.obj:'Offer');A.w(['Site'],function(){Site.initImages({onExit:function(){that.showChargeBackDialog(input)},onDelete:function(id,image_id){var post={r:'user/main',image_id:image_id*1,offer_id:input.offer_id,ok:function(){that.showChargeBackDialog(input)}};if(input.obj){post[input.obj]='delete_uploaded'}else{post.Offer='delete_uploaded'}
B.post(post)},get:{chargeback:input.offer_id}});that.showChargeBackData=input;Site.initFileUploader({obj:input.obj?input.obj:'Offer',id:input.offer_id,get:{chargeback:input.offer_id}});that.controlRunArbitrage({id:input.offer_id});$('.controlRunArbitrage').unbind('change').change(function(){that.controlRunArbitrage({id:input.offer_id})}).unbind('keyup').keyup(function(){that.controlRunArbitrage({id:input.offer_id})}).unbind('mouseup').mouseup(function(){that.controlRunArbitrage({id:input.offer_id})})})},buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){}}},message:'<div class="chargeback_host"></div>',css:D.getCss({type:'no'})})}})},controlRunArbitrage:function(input){var id=input.id;if($('.challenge_reason').val()&&($('.challenge_reason').hasClass('Deal_claim')||$('.chargeback_host .image_preview_host').length)){B.click($('.button_ok').unbind('click').css({opacity:1,cursor:'pointer'}),function(obj){D.hide();B.post({r:'user/main',Offer:'run_chargeback',id:id,claim:$('.challenge_reason').val()})})}else{$('.button_ok').unbind('click').css({opacity:0.5,cursor:'default'})}},chargeBackShowImage:function(input){var that=this;Site.showImage($.extend(input,{onExit:function(){that.showChargeBackDialog(that.showChargeBackData)},onDelete:function(id,image_id){if(input.obj&&input.obj=='Deal'){B.post({r:'user/main',Deal:'delete_uploaded',offer_id:id,image_id:image_id*1,ok:function(){that.showChargeBackDialog(that.showChargeBackData)}})}else{B.post({r:'user/main',Offer:'delete_uploaded',offer_id:id,image_id:image_id*1,ok:function(){that.showChargeBackDialog(that.showChargeBackData)}})}}}))},chargeBackUploadedFiles:function(input){var that=this;var host=$('.uploaded_files_host');$('.image_preview_host',host).remove();host.append(input.html);Site.initImages({onExit:function(){that.showChargeBackDialog(that.showChargeBackData)},onDelete:function(id,image_id){var post={r:'user/main',offer_id:id,image_id:image_id*1,ok:function(){that.showChargeBackDialog(that.showChargeBackData)}};post[input.obj?input.obj:'Offer']='delete_uploaded';B.post(post)},get:{chargeback:input.offer_id}});that.controlRunArbitrage({id:input.offer_id})},selected_payment_type:!1,showPaymentDetails:function(input){var that=this;D.show({title:input.title,message:input.message,cls:'dialog-asphalt',onShow:function(){that.initSendConfirmationButton();that.initImages(input.mode=='seller'?1:0);that.initConfirmAgainButton(input);that.restartRemainTimer();A.w(['Site'],function(){Site.initFileUploader({obj:'Offer',id:input.offer_id})});B.click($('.run_challenge'),function(obj){D.hide(function(){that.showChargeBackDialog({offer_id:B.getId(obj),onExit:function(){D.hide(function(){that.showPaymentDetails(input)},!1,'slide')}})},!1,'slide')})}})},initConfirmAgainButton:function(input){var that=this;B.click($('.ask_confirmation'),function(obj){D.hide(function(){that.showReconfirmDialog(B.getId(obj,'offer_id_'),input)})});B.click($('.release_balance'),function(obj){D.hide(function(){D.show({title:{sure_that_release_funds:{en:'You receive the required amount and ready to release guarantee balance?',ru:'Вы получили требуемую сумму и готовы выпустить гарантийный балланс?'}},exit:function(){D.hide(function(){that.showPaymentDetails(input)},!1,'slide')},message:'<div class="msg_1278"></div>',onShow:function(){T.translate({once_you_release:{en:'Please be careful! The operation is irreversible, and it is impossible to challenge!',ru:'Будьте внимательны! Операция необратима, и ее невозможно оспорить!'}},$('.msg_1278'))},css:D.getCss({type:'no'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide(function(){B.post({r:'user/main',Offer:'release',offer_id:B.getID(obj,'offer_id_'),update_sell_board:$('.available_offers_host').is(':visible')?that.selected_payment_type:0})})}}}})},!1,'slide')})},showReconfirmDialog:function(offer_id,input){var that=this;D.show({title:{reconfirm_title:{en:'Ask buyer to confirm payment once again',ru:'Попросите покупателя подтвердить платеж еще раз'}},exit:function(){D.hide(function(){that.showPaymentDetails(input)},!1,'slide')},css:D.getCss({type:'norm'}),message:'pages/dialogs/reconfirm_message.php',buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide(function(){B.post({r:'user/main',Offer:'ask_confirmation',offer_id:offer_id,message:$('.dialog .message_to_buyer').val(),update_sell_board:$('.available_offers_host').is(':visible')?that.selected_payment_type:0})})}}}})},viewClaim:function(input){var that=this;D.show({title:{view_claim_title2:{en:'Your partner has run chargeback procedure, his claim:',ru:'Ваш партнер запустил процедуру отмены сделки, его претензия:'}},message:input.message||!1,css:D.getCss({type:'no'}),onShow:function(){that.initImages(function(){that.viewClaim(input)});that.restartRemainTimer();B.click($('.run_challenge'),function(obj){D.hide(function(){that.showChargeBackDialog({offer_id:B.getId(obj),onExit:function(){D.hide(function(){that.viewClaim(input)},!1,'slide')}})},!1,'slide')});B.click($('.accept_claim'),function(obj){D.hide(function(){D.show({title:{sure_to_accept_claim:{en:'Are you sure to accept the claim?',ru:'Вы уверены что признаете претензию?'}},css:D.getCss({type:'ok'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({r:'user/main',Offer:'accept_claim',offer_id:B.getID(obj)})}}}})},!1,'slide')})}})},initSendConfirmationButton:function(){if($('.image_preview_host').length&&$('.image_preview_host').is(':visible')){$('.button_confirm').css({opacity:1,cursor:'pointer'}).unbind('click').click(function(){var obj=$(this);B.press(obj);D.hide(function(){B.post({r:'user/main',Offer:'send_payment_confirmation',offer_id:B.getID(obj,'id_')})})})}else{$('.button_confirm').css({opacity:0.6,cursor:'default'}).unbind('click')}},findOffers:function(input,showPreloader){B.get({r:'user/main',Offer:'get_sell',page:input.page?input.page:0,payment_id:input.payment_id?input.payment_id:null,filter:$('input:radio[name="currency_nominal_filter"]:checked').val(),amount:$('.fill_balance_amount').val()*1,initiated:1},showPreloader)},showAvailableOffers:function(data){var that=this;if(data&&(data.balance||data.balance===0)){User.data.money=data.balance*1;$('.user_balance_detector').html(User.data.money+'$')}
if(data&&data.payment_id*1){that.selected_payment_type=data.payment_id;$('.button_payment_method_host .payment_method_host',$('.fill_up_host')).removeClass('active');if(data.payment_id){$('.button_payment_method_host .payment_method_host.id_'+data.payment_id,$('.fill_up_host')).addClass('active')}}
if(data&&data.currencies){$('.currency_filter_host').html(data.currencies).show();if($('.currency_nominal_filter').length){$('.currency_nominal_filter').unbind('change').change(function(){$('.available_offers_list').slideUp();that.findOffers({page:0},!0)})}}else{$('.currency_filter_host').hide()}
if(data&&data.selling){$('.available_offers_host').slideDown();$('.available_offers_list').html(data.selling).slideDown();$('.goto_page.selling_offers').unbind('click').click(function(){that.findOffers({page:B.getID($(this))},!0)});B.click($('.hide_offer'),function(obj){var id=B.getID(obj,'id_');D.show({title:{sure_that_spam:{en:'Are you sure that payment details are wrong or this is spam?',ru:'Вы уверены что платежные реквизиты неправильные или это спам?'}},message:'pages/dialogs/spam_report.php',css:D.getCss({type:'no'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Hide:'hide',offer_id:id,description:$('.spam_report').val()})}}}})});B.click($('.accept_offer'),function(obj){var id=B.getID(obj,'id_');if($('.fill_balance_amount').val()*1<=0){D.show({title:'pages/dialogs/error.php?error=amount_expected_not_zero',message:!1,css:D.getCss({type:'no'})})}else{if(obj.hasClass('disableShow')){return}
obj.addClass('disableShow');D.show({title:'pages/dialogs/confirmation.php?offer_id='+id+'&type=accept_balance_fillup_offer&requested_amount='+$('.fill_balance_amount').val()*1+'&method='+that.selected_payment_type,buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide(function(){B.post({r:'user/main',Offer:'accept',id:id,amount:$('.fill_balance_amount').val()*1,payment_id:that.selected_payment_type})})}}},onShow:function(){obj.removeClass('disableShow');$('.viewUser.fromAcceptForm').unbind('click').click(function(){var id=B.getId($(this));if($('.contragent_details').hasClass('isEmpty')){B.get({User:'view',user_id:B.getID($(this)),heIs:'seller',ok:function(response){$('.contragent_details').html(response.User.showUserProfile.html).slideDown().removeClass('isEmpty')}})}else if($('.contragent_details').is(':visible')){$('.contragent_details').slideUp()}else if(!$('.contragent_details').is(':visible')){$('.contragent_details').slideDown()}});B.click($('.hide_offer'),function(obj){var id=B.getID(obj,'id_');D.hide(function(){D.show({title:{sure_that_spam:{en:'Are you sure that payment details are wrong or this is spam?',ru:'Вы уверены что платежные реквизиты неправильные или это спам?'}},message:'pages/dialogs/spam_report.php',css:D.getCss({type:'no'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Hide:'hide',offer_id:id,description:$('.spam_report').val()})}}}})})})},message:'pages/dialogs/confirmation.php?offer_id='+id+'&type=not_enough_money_notification&requested_amount='+$('.fill_balance_amount').val()*1+'&method='+that.selected_payment_type,css:D.getCss({type:'blue'})})}})}else{if(data&&!data.selling&&data.initiated){$('.available_offers_host').show();A.w(['T'],function(){T.translate({no_offers_have_found2:{en:'<span style="color:red;">No offers. Try another payment menthod.</span>',ru:'<span style="color:red;">Нет предложений. Попробуйте другой способ оплаты.</span>'}},$('.available_offers_list'))})}else{}}
if(data&&data.confirmed){$('.confirmed_offers_host').show();$('.confirmed_offers_list').html(data.confirmed);B.click($('.reload_confirmation',$('.fill_up_host')),function(obj){that.confirmByByer({id:B.getID(obj,'id_'),confirmed:1})})}else{$('.confirmed_offers_host').hide()}
if(data&&data.accepted){$('.accepted_offers_host').show();$('.accepted_offers_list').html(data.accepted);B.click($('.info_offer'),function(obj){B.post({r:'user/main',Offer:'payment_details',offer_id:B.getID(obj,'id_')})});B.click($('.confirm_payment'),function(obj){that.confirmByByer({id:B.getID(obj,'id_')})})}else{$('.accepted_offers_host').hide()}
if(data&&data.disputed){$('.disputed_offers_host').show();$('.disputed_offers_list').html(data.disputed);B.click($('.cancel_chargeback'),function(obj){D.show({title:{are_you_sure_to_cancel_claim_and_continue_transaction:{en:'Are you sure to cancel the claim?',ru:'Вы уверены что снимаете претензию?'}},message:!1,css:D.getCss({type:'ok'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({r:'user/main',Offer:'cancel_chargeback',offer_id:B.getId(obj)})}}}})});B.click($('.view_claim'),function(obj){B.get({r:'user/main',Offer:'view_claim',offer_id:B.getId(obj)})})}else{$('.disputed_offers_host').hide()}
if(data&&(data.accepted||data.confirmed||data.disputed)){that.restartRemainTimer();B.click($('.claim_automatic_offer',$('.fill_up_host')),function(obj0){D.show({title:{you_transfer_money_but_balance_is_not_filled:{en:'You transferred money but the balance is not filled?',ru:'Вы перевели деньги но баланс не пополнен?'}},message:'pages/balance/claim_automatic_payment.php',cls:'dialog-asphalt',onShow:function(){B.click($('.claim_automatic_payment .just_cancel_offer'),function(obj){D.hide(function(){B.post({r:'user/main',Offer:'cancel_by_byer',offer_id:B.getID(obj0),update_sell_board:$('.available_offers_host').is(':visible')?that.selected_payment_type:0})})});B.click($('.claim_automatic_payment .request_refund'),function(obj){D.hide(function(){that.showChargeBackDialog({offer_id:B.getId(obj0)})},!1,'slide')})}})});B.click($('.cancel_offer',$('.fill_up_host')),function(obj){D.show({title:{sure_that_you_want_to_cancel_the_order7:{en:'Are you sure to cancel fill up request?',ru:'Вы уверены, что хотите отменить заявку на пополнение?'}},message:'pages/dialogs/confirmation.php?type=cancel_fillup_order_red_message',css:D.getCss({type:'no'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide(function(){B.post({r:'user/main',Offer:'cancel_by_byer',offer_id:B.getID(obj),update_sell_board:$('.available_offers_host').is(':visible')?that.selected_payment_type:0})})}}}})})}
$('.request_line .user').unbind('click').click(function(){B.get({User:'view',user_id:B.getID($(this)),heIs:$(this).hasClass('heIsSeller')?'seller':'buyer'})})},gotoPaymentPage:function(input){location.href=input.url},confirmByByer:function(input){var that=this;B.get({r:'user/main',Offer:'confirm_by_byer',offer_id:input.id,confirmed:input.confirmed||0,update_sell_board:$('.available_offers_host').is(':visible')?that.selected_payment_type:0})},changeOffersBecauseChangeAmountTimer:!1,changeOffersBecauseChangeAmount:function(payment_id){var that=this;if(that.changeOffersBecauseChangeAmountTimer){clearTimeout(that.changeOffersBecauseChangeAmountTimer)}
that.changeOffersBecauseChangeAmountTimer=setTimeout(function(){that.findOffers({payment_id:payment_id,page:0},!1)},500)},control:function(){var that=this;if(window.Comission){var comission=Math.max(Comission.minimum,$('.fill_balance_amount').val()*Comission.value);var tobalance=Math.max(0,$('.fill_balance_amount').val()-comission)}else{var comission=0;var tobalance=0}
if($('.fill_balance_amount').length){B.forceToFloat($('.fill_balance_amount'),0)}
if($('.fill_balance_amount_default').val()*1!=$('.fill_balance_amount').val()*1){if($('.fill_up_host .payment_method_host.active').length){if($('.fill_balance_amount').val()*1>0){that.changeOffersBecauseChangeAmount(B.getID($('.fill_up_host .payment_method_host.active')))}}
$('.fill_balance_amount_default').val($('.fill_balance_amount').val());if($('.fill_balance_amount').val()*1>0){A.w(['Comission'],function(){$('.credited_b',$('.comission_indicator_host').css({visibility:'visible'})).html(B.round(tobalance,0.01));$('.comission_b').html(B.round(comission,0.01))});if(tobalance>0){B.click($('.fill_up_host .payment_method_host').removeClass('available').addClass('available'),function(obj){obj.removeClass('active').addClass('active');$('.available_offers_list').slideUp();that.findOffers({payment_id:B.getId(obj,'id_'),page:0},!0)})}else{B.click($('.fill_up_host .payment_method_host').removeClass('available').removeClass('active'),function(obj){D.show({title:{tobalance:{en:'Too small amount, less than service comission!',ru:'Слишком маленькая сумма, меньше комиссии сервиса!'}},css:D.getCss({type:'no'})})})}}else{$('.comission_indicator_host').css({visibility:'hidden'});$('.fill_up_host .payment_method_host').removeClass('available').unbind('click');$('.available_offers_list').html('');$('.available_offers_host').hide()}}
if($('.withdraw_amount').length){B.forceToFloat($('.withdraw_amount'),0,User.data.money*1)}
if($('.withdraw_amount').val()*1>0){$('.payment_method_host',$('.withdraw_host')).css({opacity:0.6,cursor:'pointer'});$('.payment_method_host.available_method',$('.withdraw_host')).css({opacity:1});B.click($('.payment_method_host',$('.withdraw_host')).css({cursor:'pointer'}),function(obj){var id=B.getID(obj,'id_');B.get({r:'user/main',UserPaymentMethod:'open',payment_id:id})})}else{$('.payment_method_host',$('.withdraw_host')).css({opacity:0.6,cursor:'default'}).unbind('click')}},outputUploadedFiles:function(input){var host=$('.uploaded_files_host');$('.image_preview_host',host).remove();host.append(input.html);Balance.initImages();Balance.initSendConfirmationButton()},imageActions:{onDelete:function(id,image_id){B.post({r:'user/main',Offer:'delete_uploaded',offer_id:id,image_id:image_id*1})},onExit:function(id){Balance.confirmByByer({id:id})},onExitClaim:function(id){Balance.viewClaim({id:id})},onExitReadonly:function(id){D.hide();B.post({r:'user/main',Offer:'payment_details',seller_check:1,offer_id:id})}},showImage:function(input){var that=this;if(!input.onExit){input.onExit=input.readonly?that.imageActions.onExitReadonly:that.imageActions.onExit}
if(!input.onDelete){input.onDelete=that.imageActions.onDelete}
Site.showImage(input)},initImages:function(readonly){var that=this;Site.initImages({readonly:readonly?1:0,onExit:readonly?(typeof readonly==='function'?function(){readonly()}:that.imageActions.onExitReadonly):that.imageActions.onExit,onDelete:that.imageActions.onDelete})}};var Bug={init:function(){var that=this;that.onShow();$('.goto_page.present_bugs').unbind('click').click(function(){that.list({page:B.getID($(this))})});B.click($('.find_present_bug'),function(obj){that.list({page:0})})},onShow:function(){var that=this;Site.control({obj:$('.bug_review'),condition:function(){return $('.bug_review').val()?!0:!1},button:$('.send_bug_button'),action:function(){B.click($('.send_bug_button'));B.post({Bug:'send',description:$('.bug_review').val()});$('.bug_review').val('');Site.scrollTo($('.search_present_bug'))}});that.buttons()},list:function(input){B.get({Bug:'list',page:input.page||0,filter:$('.search_present_bug').val()})},out:function(input){var that=this;$('.bug_list').html(input.html);that.buttons()},buttons:function(){var that=this;$('.goto_page.present_bugs').unbind('click').click(function(){that.list({page:B.getID($(this))})});$('.show_hidden').unbind('click').click(function(){$(this).hide();$(this).siblings('span').show()});B.click($('.reject_bug_button'),function(obj){B.post({Bug:'reject',id:B.getId(obj),page:B.getID($('.bug_list .goto_page.current'))})});B.click($('.accept_bug_button'),function(obj){B.post({Bug:'accept',id:B.getId(obj),page:B.getID($('.bug_list .goto_page.current'))})});B.click($('.paid_bug_button'),function(obj){B.post({Bug:'paid',id:B.getId(obj),page:B.getID($('.bug_list .goto_page.current'))})});B.click($('.fixed_bug_button'),function(obj){B.post({Bug:'fixed',id:B.getId(obj),page:B.getID($('.bug_list .goto_page.current'))})})}};var Buttons={list:{},create:function(p){return this.place(p)},place:function(p){if(p.id&&this.list[p.id]){var but=this.list[p.id];if(p.refresh){but.remove();this.list[p.id]=null}else{but.show();return but}}
var but=new Button(p);this.list[but.id]=but;return but}};var Button=function(p){this.hide=function(){this.$.hide()};this.show=function(){this.$.show()};this.remove=function(){this.$.remove()};this.place=function(p){var id=p.id||Math.round(Math.random()*10000);this.host=p.host||document.body;this.status=p.status?p.status:'enabled';this.id=id;var that=this;if($('.button_'+id).length){if(p.id){console.error('Object with '+id+' already present');return !1}
that.place(p);return !1}
var obj=Base.appendOnce({host:Base.appendOnce({html:'<div class="raw_controls invisible pa"></div>',selector:'.raw_controls'}),html:'<div class="raw_button_host pr"><table class="raw_button button"><tr><td class="button_text ac vm"></td></tr></table></div>',selector:'.raw_button_host'}).clone();$('.raw_button',obj).removeClass('raw_button').addClass('button_'+id);obj.removeClass('raw_button_host').addClass('button_host_'+id).addClass('button_host').appendTo(this.host);obj.show();this.$=$('.button_'+id);$('.button_text',this.$).html(p.title);if(p.outer){if(p.outer.css){$('.button_host_'+id).css(p.outer.css)}}
if(p.css){this.$.css(p.css)}
if(p.cls){if(p.cls.join){this.$.addClass(p.cls.join(' '))}else{this.$.addClass(p.cls)}}
if(p.onDisable){this.onDisable=p.onDisable}else{this.onDisable=!1}
var that=this;this.$.unbind('mousedown').mousedown(function(){if(that.status==='enabled'){Base.press($(this));if(p.action){p.action(that.id)}}else{if(that.onDisable){that.onDisable(that.id)}else{console.log(that.status)}}});if(this.status!=='enabled'){this.disable()}};this.disable=function(){this.$.css({opacity:0.5,cursor:'default'});this.status='disabled'};this.enable=function(){this.$.css({opacity:1,cursor:'pointer'});this.status='enabled'}
this.place(p)};var Calculator={comission:!1,init:function(){this.initCalculator();this.onShow()},onShow:function(){A.w(['User'],function(){if(User.data){$('.menu_button_login').hide()}else{$('.menu_button_login').show()}})},initCalculator:function(){var that=this;if(that.comission===!1){setTimeout(function(){that.initCalculator()},50)}else{that.calculate();$('.amount_calculate_comission').unbind('change').change(function(){that.calculate()}).unbind('keyup').keyup(function(){that.calculate()}).unbind('mouseup').mouseup(function(){that.calculate()})}},calculate:function(){var that=this;var fee=B.round(Math.max(that.minimum,$('.amount_calculate_comission').val()*that.comission),0.01);B.forceToFloat($('.amount_calculate_comission'),0);$('.comission_indicator').html(fee);$('.iwannaget').html($('.amount_calculate_comission').val());if(fee==that.minimum){$('.minimum_detector').show()}else{$('.minimum_detector').hide()}
var n=B.round($('.amount_calculate_comission').val()/(1-that.comission),0.01);if($('.amount_calculate_comission').val()*that.comission/(1-that.comission)<that.minimum){n=$('.amount_calculate_comission').val()*1+that.minimum}
$('.needtobuy').html(n)}};var CheckBoxes={list:{},place:function(p){var but=new CheckBox(p);this.list[but.id]=but}};var CheckBox=function(p){this.place=function(p){var id=p.id||Math.round(Math.random()*10000);this.host=p.host||document.body;this.id=id;this.status=p.status*1||0;var that=this;if($('.checkbox_box_'+id).length){if(p.id){console.error('Object with '+id+' already present');return !1}
that.place(p);return !1}
var obj=$('.raw_checkbox').clone();$('.checkbox_box_raw',obj).removeClass('checkbox_box_raw').addClass('checkbox_'+id).addClass('checkbox_box').attr({id:'checkbox_'+id});$('.check_box_title_raw',obj).removeClass('checkbox_title_raw').addClass('checkbox_title_'+id).addClass('checkbox_title');$('.raw_checkbox_var',obj).removeClass('raw_checkbox_var').addClass('checkbox_var_'+id).attr({name:'checkbox_'+id,value:this.status});this.v=$('.checkbox_var_'+id);obj.removeClass('raw_checkbox').addClass('checkbox_host_'+id).addClass('checkbox_host');if(p.cls){obj.addClass(p.cls)}
if(p.prepend){obj.prependTo(this.host)}else{obj.appendTo(this.host)}
obj.css({display:'inline-block'}).show();this.$=$('.checkbox_host_'+id);$('.checkbox_title_'+id).html(p.title);if(p.css){this.$.css(p.css)}
if(p.class){if(p.class.join){this.$.addClass(p.class.join(' '))}else{this.$.addClass(p.class)}}
$('.checkbox_'+id,this.$).unbind('mousedown').mousedown(function(){var id=$(this).attr('id').split('checkbox_')[1];var obj=CheckBoxes.list[id];if(obj.status){$('.checkbox_'+id).html('');obj.status=0}else{$('.checkbox_'+id).html('✓');obj.status=1}
obj.v.attr('value',obj.status);if(p.action){p.action(obj.status)}})};this.setStatus=function(status){if(this.status!=status){if(status==1){$('.checkbox_'+this.id).html('✓')}else{$('.checkbox_'+this.id).html('')}
this.status=status==0?0:1;this.v.attr('value',this.status)}};this.place(p)};var Client={timer:!1,self_time:{start_time:0,count:0,total:0,},observer_time:{start_time:0},time_offset:!1,ping:!1,server_time:!1,observePing:function(){this.self_time.start_time=Date.now();B.get({r:'user/main',Unit:'ping'})},getTimeOffset:function(input){var that=this;var client_time=Date.now();var ping=client_time-this.self_time.start_time;this.self_time.count+=1;this.self_time.total+=(input.server_time+ping/2000-client_time/1000);this.time_offset=this.self_time.total/this.self_time.count;setTimeout(function(){that.observePing()},input.delay?input.delay:that.frequency)},getPing:function(input){var client_time=Date.now();this.ping=client_time-this.observer_time.start_time;this.server_time=input.server_time+this.ping/2000},frequency:250,command:'stop',ignoreResponse:!1,removeIgnoreFlag:function(input){if(input.mark==this.ignoreResponse){this.ignoreResponse=!1}},observe:function(time){var that=this;that.observer_time.start_time=Date.now();if(time){that.frequency=time}
var mark=Math.round(Math.random()*1000000);Base.get({r:'user/main',Field:'status',mark:mark,command:that.command,no:function(){that.reStart()}});that.command=!1;return mark},reStart:function(input){var that=this;that.removeIgnoreFlag(input);that.stop();that.timer=setTimeout(function(){that.observe()},that.frequency)},stop:function(){var that=this;if(that.timer){clearTimeout(that.timer);that.timer=!1}}};var Contacts={init:function(){this.onShow()},onShow:function(){var that=this;if(User.data){$('.menu_button_login').hide()}else{$('.menu_button_login').show()}
if(User.data&&!$('.send_email_button').length){window.location.reload(!0)}
$('.r_control').unbind('keyup').keyup(function(){that.control()}).unbind('mouseup').mouseup(function(){that.control()}).unbind('change').change(function(){that.control()});that.control()},control:function(){var that=this;if($('.landing_email').val()){B.click($('.send_email_button').css({opacity:1,cursor:'pointer'}),function(obj){$('.landing_response').slideUp();B.post({r:'user/main',Landing:'send',email:$('.landing_email').val(),message:$('.landing_review').val(),ok:function(response){if(response&&response.ok){$('.landing_response').removeClass('landing_error').removeClass('landing_success').addClass('landing_success').slideDown().html(response.ok);$('.landing_email').val('');$('.landing_review').val('')}else if(response){if(response.User){window.location.assign('/login')}}},no:function(response){$('.landing_response').removeClass('landing_error').removeClass('landing_success').addClass('landing_error').slideDown().html(response.message)}})})}else{$('.send_email_button').css({opacity:0.5,cursor:'default'}).unbind('click')}},};var Customer={init:function(){A.w(['Deal'],function(){Deal.init()})},onShow:function(){A.w(['Deal'],function(){Deal.onShow()})}};var Deal={init:function(){this.onShow()},onShow:function(){var that=this;that.update()},update:function(input){if($('.customer_page').is(':visible')){B.get({Deal:'list',role:'customer',page:0});$('.indicator_customer').hide()}else if(input&&input.role=='customer'){$('.indicator_customer').fadeOut(function(){$('.indicator_customer').show()})}
if($('.seller_page').is(':visible')){B.get({Deal:'list',role:'seller',page:0});$('.indicator_seller').hide()}else if(input&&input.role=='seller'){$('.indicator_seller').fadeOut(function(){$('.indicator_seller').show()})}},form:function(input){var that=this;D.show({title:input.title,message:input.message,cls:'dialog-asphalt',onShow:function(){that.images(input.offer_id);Site.restoreFormParameters('Deal');that.control('init');$('.viewUser.fromForm').unbind('click').click(function(){B.get({User:'view',user_id:B.getID($(this)),ok:function(response){if(response.User&&response.User.showUserProfile){A.w(['User'],function(){D.show({title:response.User.showUserProfile.name,css:D.getCSS({type:'norm'}),message:response.User.showUserProfile.html,exit:function(){D.hide(function(){that.form(input)},!1)},onShow:function(){Site.initImages({readonly:1,onExit:function(){User.showUserProfile(response.User.showUserProfile)}})}})})}}})})},buttons:input.noaction?!1:{ok:{image:A.baseURL()+'images/go.png',action:function(){}}}})},control:function(init){var that=this;if(init){B.initControl($('.input'),function(){that.control()})}
B.forceToFloat($('.Deal_amount'),0);B.forceToInt($('.Deal_term'),0);var post=!1;$('.input',$('.form_Deal')).each(function(){if($(this).val()!=$(this).attr('default')||$(this).hasClass('required')){if(!post){post={Deal:'set',id:B.getID($(this))}}
post[B.getID($(this),'Deal_')]=$(this).val()}});$('.required',$('.form_Deal')).each(function(){if(!$(this).val()||$(this).val()*1==0){post=!1}});if(post){$('.button_ok').css({opacity:1}).unbind('click').click(function(){D.hide();B.post(post)})}else{$('.button_ok').css({opacity:0.5}).unbind('click')}},load:function(offer_id){B.get({Deal:'load',id:offer_id})},outputUploadedFiles:function(input){var that=this;var host=$('.uploaded_files_host');$('.image_preview_host',host).remove();host.append(input.html);that.images()},images:function(offer_id){var that=this;A.w(['Site'],function(){Site.initImages({onExit:function(id){B.get({Deal:'load',id:id})},onDelete:function(offer_id,image_id){B.post({Deal:'delete_uploaded',offer_id:offer_id,image_id:image_id*1})}});Site.initFileUploader({obj:'Deal',id:offer_id})})},list:function(input){var that=this;if(input.seller||input.customer){$('.customer_page .simple_deals_host').html(input.customer);$('.seller_page .simple_deals_host').html(input.seller);var host=input.seller?$('.seller_page .simple_deals_host'):$('.customer_page .simple_deals_host');Site.contextHelpProcessor($('.my_444',host));Site.contextHelpProcessor($('.me_444',host));Site.contextHelpProcessor($('.accepted_444',host));Site.contextHelpProcessor($('.completed_444',host));Site.contextHelpProcessor($('.disputed_444',host));$('.viewUser').unbind('click').click(function(){B.get({User:'view',user_id:B.getID($(this))})});B.click($('.deal_description',host),function(obj){B.get({Deal:'load',id:B.getID(obj)})});B.click($('.create_simple_deal',input.seller?$('.seller_page'):$('.customer_page')),function(){B.post({Deal:'create',role:$('.customer_page').is(':visible')?'customer':'seller'})});B.click($('.cancel_deal',host),function(obj){var id=B.getID(obj);D.show({title:obj.hasClass('isCreator')?(obj.hasClass('isFunded')?{'sure_to_cancel (in deal list) 3':{en:'Are you sure to cancel the deal? The deposit will be refunded to customer.',ru:'Вы уверены, что хотите отменить сделку? Депозит будет возвращен покупателю.'}}:{'sure_to_cancel (in deal list)':{en:'Are you sure to cancel the deal?',ru:'Вы уверены, что хотите отменить сделку?'}}):{'sure to reject the offer (in deal list)':{en:'Are you sure to reject the offer?',ru:'Вы уверены что хотите отклонить предложение?'}},message:!1,buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'cancel',id:id})}}},css:D.getCSS({type:'no'})})});B.click($('.add_contractor'),function(obj){that.addContractor({id:B.getID(obj)})});B.click($('.reject_counterparty'),function(obj){D.show({title:{sure_to_temporary_withdraw_offer:{en:'Are you sure to temporary withdraw offer?',ru:'Вы уверены что хотите временно отозвать предложение?'}},message:!1,css:$.extend(D.getCSS({type:'no'}),{message_back:{background:'rgba(255,215,0,0.8)'}}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'pause',id:B.getID(obj)})}}},})});B.click($('.accept_deal'),function(obj){D.show({title:{sore_to_accept_the_offer:{en:'Are you sure to accept this offer?',ru:'Вы уверены что хотите принять предложение?'}},css:D.getCSS({type:'ok'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'accept',id:B.getID(obj)})}}},message:!1})});B.click($('.deal_completed'),function(obj){D.show({title:{'sure to report work/delivery as completed':{en:'Are you sure to report deal as completed?',ru:'Вы уверены что хотите уведомить о выполнении обязательств?'}},message:!1,buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'complete',id:B.getID(obj)})}}},css:D.getCSS({type:'ok'})})});B.click($('.deal_ok'),function(obj){D.show({title:{'sure to accept and release':{en:'Are you sure accept results and release deposit?',ru:'Вы уверены что хотите принять результаты и выплатить депозит?'}},message:!1,buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'release',id:B.getID(obj)})}}},css:D.getCSS({type:'ok'})})});B.click($('.deal_restart'),function(obj){D.show({title:{'you have not completed yet':{en:'You have not completed everything yet?',ru:'Вы еще не все закончили?'}},message:!1,buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'restart',id:B.getID(obj)})}}},css:D.getCSS({type:'ok'})})});B.click($('.deal_correct'),function(obj){B.get({Deal:'loadCorrectionForm',id:B.getID(obj)})});B.click($('.deal_chargeback'),function(obj){A.w(['Balance'],function(){Balance.showChargeBackDialog(obj.hasClass('isCounter')?{offer_id:B.getID(obj),obj:'Deal',isCounter:1}:{obj:'Deal',offer_id:B.getID(obj)})})});B.click($('.deal_cancel_claim'),function(obj){D.show({title:{'sure_to_cancel_claim (in deal list)2':{en:'Are you sure to cancel your claim and return the deal to previous state?',ru:'Вы уверены что хотите отменить свою претензию и вернуть сделку к преженему состоянию?'}},css:D.getCSS({type:'norm'}),message:!1,buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'cancel_claim',id:B.getID(obj)})}}}})});B.click($('.deal_admit_claim'),function(obj){D.show({title:{'sure_to_admit_claim (in confirmation)':{en:'Are you sure to admit a claim?',ru:'Вы уверены что призанете претензию?'}},message:'pages/deal/admit_confirmation.php?role='+($('.customer_page').is('visible')?'customer':'seller'),css:D.getCSS({type:'no'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'admit',id:B.getID(obj)})}}}})})}},showCorrectionForm:function(input){var that=this;D.show({title:{'what_is_it_necessary_to_correct':{en:'What is it necessary to correct?',ru:'Что необходимо исправить?'}},buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post({Deal:'correct',message:$('.Deal_reconfirm').val(),id:input.id})}}},css:D.getCss({type:'norm'}),message:input.message,onShow:function(){$('.viewUser.fromForm').unbind('click').click(function(){B.get({User:'view',user_id:B.getID($(this)),ok:function(response){if(response.User&&response.User.showUserProfile){A.w(['User'],function(){D.show({title:response.User.showUserProfile.name,css:D.getCSS({type:'norm'}),message:response.User.showUserProfile.html,exit:function(){D.hide(function(){that.showCorrectionForm(input)},!1)},onShow:function(){Site.initImages({readonly:1,onExit:function(){User.showUserProfile(response.User.showUserProfile)}})}})})}}})});A.w(['Site'],function(){Site.initImages({onExit:function(id){B.get({Deal:'loadCorrectionForm',id:id})},onDelete:function(offer_id,image_id){B.post({Deal:'delete_uploaded',offer_id:offer_id,image_id:image_id*1})}})});Site.initFileUploader({obj:'Deal',id:input.id})}})},closeInvitationDialog:function(input){if($('.counterparty_invitation_link').is(':visible')){D.hide()}},callUpdateInvitationLink:function(id){B.get({Deal:'update_invitation_link',offer_id:id})},updateInvitationLink:function(input){$('.counterparty_invitation_link').val(input.href)},addContractor:function(input){var that=this;D.hide(function(){D.show({title:{invite_contractor:{en:'Find and invite contractor',ru:'Найти и пригласить контрагента'}},cls:'dialog-invite',message:'pages/deal/invite.php?offer_id='+input.id,onShow:function(){that.callUpdateInvitationLink(input.id);that.searchControl(input,$('.contractor_name'));$('.contractor_name').unbind('keyup').keyup(function(){var val=$(this).val();if(val.length>3){that.runSearch({page:0,what:$(this).val(),offer_id:input.id})}})}})},!1,'slide')},searchControl:function(input,obj){var that=this;Site.control({obj:obj||!1,condition:function(){return $('.contractor_name').val()&&!that.nowSearching?!0:!1},button:$('.search_contractor'),during:function(){$('.contractor_list_error').hide()},action:function(){that.runSearch({page:0,what:$('.contractor_name').val(),offer_id:input.id})}})},nowSearching:!1,runSearch:function(input){var that=this;if(that.nowSearching){return !1}
that.nowSearching=!0;that.searchControl({id:input.offer_id});var page=input.page;var that=this;B.get({Deal:'search',page:page,what:input.what,ok:function(response){that.nowSearching=!1;that.searchControl({id:input.offer_id});$('.contractor_list').html(response.html);$('.invite_contractor_host .pagination_host').html(response.pagination);if(response.html){$('.contractor_list_host').slideDown();$('.contractor_list_error').slideUp()}else{$('.contractor_list_host').slideUp();$('.contractor_list_error').slideDown();return}
B.click($('.invite_contractor_host .pagination'),function(obj){that.runSearch({page:B.getId(obj),what:input.what,offer_id:input.offer_id})});B.click($('.invite_contractor_host .list_user_profile'),function(obj){D.hide();B.post({Deal:'invite',user_id:B.getId(obj),offer_id:input.offer_id,role:$('.customer_page').is(':visible')?'customer':'seller'})})}})}};var Facebook={appId:!1,init:function(appId,ok,no){var that=this;$.getScript('//connect.facebook.net/en_UK/all.js',function(){that.appId=appId;FB.init({appId:appId,xfbml:!0,version:'v2.1',status:!0,cookie:!0});FB.Canvas.setAutoGrow(500);FB.getLoginStatus(function(response){if(response.status=='connected'){that.onLogin(response,ok)}else{if(Base.inIframe()&&!Base.inIpad()){FB.login(function(response){that.onLogin(response,ok)},{scope:'user_friends, email'})}else{if(no){no()}else{FB.login(function(response){that.onLogin(response,ok)},{scope:'user_friends, email'})}}}},!0)})},onLogin:function(response,callback){if(response.status=='connected'){FB.api('/me',function(data){if(callback){data.token=response.authResponse.accessToken;callback(data)}})}else{console.error('not connected');top.location='https://facebook.com/'}},checkPermissions:function(required,ok,no){FB.api('/me/permissions',function(response){if(!response||!response.data){if(no){no(response)}else{console.error('no response from /me/permissions',response)}
return !1}
if(!required){return !1}
for(var i in response.data){if((response.data[i].permission===required&&response.data[i].status==='granted')||(response.data[i][required])){ok(response);return !0}}
if(no){no(response)}else{console.error('permissions:',$response)}})},redirectLogin:function(input){var url='https://www.facebook.com/dialog/oauth?client_id='+this.appId+'&redirect_uri='+encodeURIComponent(input.return_to)+'&scope='+input.scope;top.location.href=url},sendRequest:function(input){if(Base.inIpad()){var that=this;var url='https://www.facebook.com/dialog/apprequests?app_id='+that.appId+'&to='+input.to+'&redirect_uri='+encodeURIComponent(input.return_to)+(input.action_type?'&action_type='+input.action_type:'')+'&message='+encodeURIComponent(input.message);top.location.href=url}else{FB.ui({method:'apprequests',message:input.message,to:input.to},function(response){if(response&&response.request){input.callback(response)}else{}})}},ask_times_remain:1,post:function(what,redirect_path){var that=this;this.checkPermissions('publish_actions',function(response){FB.api('/me/feed','post',{message:what},function(response){if(!response||response.error){console.error('error in me/feed',JSON.stringify(response.error))}else{}})},function(response){console.log('no permission');if(Base.inIpad()){if(redirect_path){that.redirectLogin({return_to:redirect_path,scope:'publish_actions'})}}else{if(that.ask_times_remain>0){that.ask_times_remain-=1;FB.login(function(response){if(response.status==='connected'){that.post(what)}else{}},{scope:'publish_actions'})}else{}}})}};var Field={setControl:function(){A.w(['$','B','Client'],function(){B.down($('.rocket_control'),function(obj){Client.command=obj.attr('alt');Client.stop();Client.ignoreResponse=Client.observe();Units.getMyRocket().command(obj.attr('alt'))})})}};var Faq={top5init:function(){$('.goto_help').unbind('click').click(function(){var id=B.getId($(this));A.w(['Site','Help'],function(){Site.switchTo('help',function(){Help.open(id)})})})},current:!1};var Help={goto:function(id){D.hide();A.w(['Site','Help'],function(){Site.switchTo('help',function(){Help.open(id)})})},open:function(id,callback){var old=Faq.current;$('.spoiler_body.id_'+old).slideUp(function(){$('.spoiler_head.id_'+old).removeClass('opened')});Faq.current=id;$('.spoiler_head.id_'+id).addClass('opened');$('.spoiler_body.id_'+id).slideDown(function(){Site.scrollTo($('.spoiler_head.id_'+id))});this.onShow()},onShow:function(){if(User.data){$('.menu_button_login').hide()}else{$('.menu_button_login').show()}},init:function(){this.onShow();var that=this;A.w(['B'],function(){B.click($('.spoiler_head'),function(obj){var id=B.getID(obj);if(id===Faq.current&&$('.spoiler_body.id_'+id).is(':visible')){$('.spoiler_body.id_'+id).slideUp(function(){$('.spoiler_head').removeClass('opened')})}else{that.open(id)}})});$('.goto_help').unbind('click').click(function(){Help.open(B.getID($(this)))})}};var Landing={init:function(){var that=this;that.onShow()},onShow:function(){var that=this;that.calculateRemainTime();B.click($('.menu_button_noticate'),function(obj){A.w(['Site'],function(){Site.scrollTo($('.notification_button_target'),0)})});A.w(['B','Calculator'],function(){Calculator.init()});$('.r_control').unbind('keyup').keyup(function(){that.control()}).unbind('mouseup').mouseup(function(){that.control()}).unbind('change').change(function(){that.control()});that.control()},control:function(){var that=this;if($('.landing_email').val()){B.click($('.landing_email_button').css({opacity:1,cursor:'pointer'}),function(obj){$('.landing_response').slideUp();B.post({r:'user/main',Landing:'create',email:$('.landing_email').val(),message:$('.landing_review').val(),ok:function(response){if(response&&response.ok){$('.landing_response').removeClass('landing_error').removeClass('landing_success').addClass('landing_success').slideDown().html(response.ok)}},no:function(response){$('.landing_response').removeClass('landing_error').removeClass('landing_success').addClass('landing_error').slideDown().html(response.message)}})})}else{$('.landing_email_button').css({opacity:0.5,cursor:'default'}).unbind('click')}},onHide:function(){$('.menu_buttons').show();$('.landing_dialog_host').html('')},when:!1,calculateRemainTime:function(){var that=this;if(that.when===!1){$('.time_left_host').hide();setTimeout(function(){that.calculateRemainTime()},100)}else{A.w(['T'],function(){var left=B.timeDifference(new Date(that.when*1000),new Date());if(left.sign<0){location.href=A.baseURL();return}
if(left.days>0){var str=left.days+' '+(T.locale=='ru'?'дней':'days')+' '}else{var str=''}
str+=' '+(left.hours<10?'0':'')+left.hours+':'+(left.minutes<10?'0':'')+left.minutes+':'+(left.seconds<10?'0':'')+left.seconds;$('.time_left').html(str);$('.time_left_host').show();setTimeout(function(){that.calculateRemainTime()},1000)})}}};var Legal={init:function(){this.onShow()},onShow:function(){var that=this;if(User.data){$('.menu_button_login').hide()}else{$('.menu_button_login').show()}}};var Login={init:function(){A.w(['U','User'],function(){if(!User.data){U.login()}});this.onShow();B.post({Spam:'send',ok:function(response){console.log(response)}})},onShow:function(){$('.menu_button_login').hide();$('.goto_page.id_calculator').unbind('click').click(function(){A.w(['Site'],function(){Site.switchTo('calculator')});return !1});A.w(['Faq','Help'],function(){Faq.top5init()});B.click($('.iwactions.menu_button_actions'),function(obj){Site.switchTo('actions',function(){Site.scrollTo($('.header_host'),-250)})});B.click($('.iwbug.menu_button_bug'),function(obj){if(!User.data){Site.scrollTo($('.header_host'),-250);D.show({title:{'you_need_to_login_at_first':{en:'Plase sign in or sign up at first',ru:'Пожалуйста, сначала войдите в систему'}},message:!1,css:D.getCss({type:'no'})})}})}};var Main={init:function(){this.onShow()},onShow:function(){B.click($('.main_b_host .menu_button'),function(obj){A.w(['Site','B'],function(){var page=B.getID(obj,'menu_button_');Site.switchTo(page,function(){Site.scrollTo($('.page_content_'+page),-250)})})});B.click($('.iwactions.menu_button_actions'),function(obj){Site.switchTo('actions',function(){Site.scrollTo($('.header_host'),-250)})});B.click($('.iwbug.menu_button_bug'),function(obj){A.w(['Site','B'],function(){var page=B.getID(obj,'menu_button_');Site.switchTo(page,function(){Site.scrollTo($('.page_content_'+page),-250)})})});$('.goto_page.id_calculator').unbind('click').click(function(){A.w(['Site'],function(){Site.switchTo('calculator')});return !1});A.w(['Faq','Help'],function(){Faq.top5init()})}};var Pagers={list:{},place:function(p){var id=p.id||'pager_'+Math.round(Math.random());if(!this.list[id]){p.id=id;this.list[id]=new Pager(p)}else{if(!p.id){this.place(p);return !1}}
return this.list[id].set(p)}};var Pager=function(p){this.create=function(p){if(!p.id){console.error('Need id when create pager!')}
this.id=p.id;this.host=p.host||$(document.body);var that=this;if(this.totalRecords<=this.recordsAtPage){$('.point_pager',this.host).remove();return}
if(!$('.point_pager',this.host).length){this.host.append('<div class="ac point_pager"></div>')}};this.set=function(p){if(p.totalRecords<=p.recordsAtPage){$('.point_pager',this.host).hide();return}else{$('.point_pager',this.host).show()}
this.maxPage=p.maxPage||!1;this.maxPageAction=p.maxPageAction||!1;this.callback=p.callback;this.recordsAtPage=p.recordsAtPage||3;this.currentPage=p.currentPage||0;this.totalRecords=this.maxPage?Math.min(p.totalRecords||0,this.maxPage*this.recordsAtPage):p.totalRecords||0
var pages=Math.ceil(this.totalRecords/this.recordsAtPage);var h=[];console.log(this);if(this.maxPage&&pages===1){}else{for(var i=0;i<pages;i++){h.push('<div class="empty_dot_pager select_page_'+i+'"></div>')}}
if(this.maxPage){h.push('<div class="triangle_host"><div class="select_page_other"><div class="arrow-down-red"></div><div class="arrow-down-gold"></div></div></div>')}
$('.point_pager',this.host).html(h.join(''));$('.select_page_'+this.currentPage,this.host).css({'background-color':'rgb(196,43,44)'});var that=this;if(this.maxPage&&this.maxPageAction){$('.select_page_other',this.host).unbind('mouseover').mouseover(function(){$('.arrow-down-gold',this.host).hide()}).unbind('mouseout').mouseout(function(){$('.arrow-down-gold',this.host).show()}).unbind('mousedown').mousedown(function(){Base.press($(this));that.maxPageAction()})}
$('.empty_dot_pager',that.host).unbind('mousedown').mousedown(function(){var page=$(this).attr('class').split('select_page_')[1]*1;if(page*1!==that.currentPage*1){$('.empty_dot_pager',that.host).css({background:'none'});$(this).css({'background-color':'rgb(196,43,44)'});var slide=that.currentPage>page?'right':'left';that.currentPage=page;if(that.callback){that.callback(page,slide)}}});return that};this.create(p)};var Selector=function(p){this.hide=function(){this.$.hide()};this.show=function(){this.$.show()};this.remove=function(){this.$.remove()};this.place=function(p){var id=p.id||Math.round(Math.random()*10000);this.host=p.host||$(document.body);this.id=id;this.action=p.action?p.action:function(id){console.log(id)};var that=this;if($('.selector_'+id).length){if(p.id){console.error('Object with '+id+' already present');return !1}
that.place(p);return !1}
this.selected=p.selected||!1;this.preselect=p.preselect;this.default=p.default||'Selector';this.markers=p.markers||{opened:'▲',closed:'▼',image:'images/t.gif'}
this.options=p.options;var h=[];for(var key in this.options){if(this.options[key].text){h.push('<table class="w100 cp select_option option_'+key+'"><tr><td class="value">'+this.options[key].text+'</td>'+(this.options[key].img?'<td style="width:25px;"><img style="width:25px;" src="'+this.options[key].img+'" alt="'+key+'"/></td>':'')+'</tr></table>')}}
this.$=Base.appendOnce({host:this.host,selector:'.selector_'+id,html:'<div class="selector selector_'+this.id+'">'+'<table class="current"><tr><td><span class="selected_title">'+this.default+'</span> <span class="marker">'+this.markers.closed+'</span></td>'+'<td style="width:25px;"><img class="selected_image" style="width:25px;" src="'+this.markers.image+'" alt/></td>'+'</tr></table>'+(this.options?'<div class="options invisible rc shadow" style="background:white;">'+h.join('')+'</div>':'')+'</div>'});this.initiator=$('.current',this.$);this.status='closed';var that=this;this.initiator.unbind('mousedown').mousedown(function(){if($('.options',that.$).is(':visible')){that.close()}else{that.open()}});$('.select_option',that.$).unbind('mousedown').mousedown(function(){var id=$(this).attr('class').split('select_option option_')[1];that.select(id)})};this.open=function(){$('.options',this.$).slideDown();this.status='opened';$('.marker',this.$).html(this.markers[this.status])};this.close=function(callback){$('.options',this.$).slideUp(function(){if(callback){callback()}});this.status='closed';$('.marker',this.$).html(this.markers[this.status])}
this.select=function(id){var that=this;if(this.options[id]){var changed=!1;if(this.selected!=id){this.selected=id;if(this.options[id].img){$('.selected_image',this.$).attr('src',this.options[id].img)}else{$('.selected_title',this.$).html(this.options[id].text)}
changed=!0}else{}
that.close(function(){if(that.action&&changed&&id!=that.preselect){that.action(id)}})}else{}};this.place(p);this.select(p.preselect)};var Seller={init:function(){A.w(['Deal'],function(){Deal.init()})},onShow:function(){A.w(['Deal'],function(){Deal.onShow()})}};var Site={required:['$','Base','T','Preloader'],history:{},currentPage:0,getPageControllerName:function(page){return page.charAt(0).toUpperCase()+page.slice(1)},switchWithError:function(input){this.switchTo(input.page);D.show({title:input.message,css:D.getCss({type:'no'}),message:!1})},switchTo:function(page0,callback,noHistory){var that=this;if(!page0){var page0='main'}
if(typeof page0==='object'){var callback=page0.callback?page0.callback:!1;var noHistory=page0.noHistory?page0.noHistory:!1;var page=page0.page}else{var page=page0}
if(that.current){var OldPage=that.getPageControllerName(that.current);A.w(['B',OldPage],function(){if(window[OldPage]&&window[OldPage].onHide){window[OldPage].onHide()}})}
if(page==='login'&&User.data){var page='main'}
if(page==='main'&&!User.data){var page='login'}
var $page=$('.'+page+'_page');var $preloader=$('.preloader_wrapper',$page);if($preloader.length){$('.page').hide();$page.fadeIn();if(!$preloader.hasClass('preloader_'+page)){$preloader.addClass('preloader_'+page);A.w(['Preloader'],function(){Preloader.show('preloader_'+page)})}
B.getHTML({file:'pages/'+page+'/'+page+'.php',once:1,selector:page+'_page .page_content',host:$page,append:1,callback:function(host){$('.page_content',host).hide();A.w(['Preloader'],function(){Preloader.hide('preloader_'+page,function(){Preloader.remove('preloader_'+page);$('.page_content',host).fadeIn(function(){if(callback){callback()}})})});var Page=that.getPageControllerName(page);A.w(['B',Page],function(){if(window[Page]&&window[Page].init){window[Page].init()}})}})}else{$('.page').slideUp();$page.slideDown(function(){var Page=that.getPageControllerName(page);if(window[Page]&&window[Page].onShow){window[Page].onShow()}
if(callback){callback()}})}
$('.menu_button_'+this.currentPage).removeClass('menu_current');Site.setCurrentPage(page);var obj={};obj['_title:'+page]={en:page,ru:page};if(!$('.temporary_translate').length){$('body').append('<div class="temporary_translate"></div>')}
var jq=$('.temporary_translate');T.translate(obj,jq,function(){$('title').text(jq.html())});if(window.history&&window.history.pushState){if(!noHistory){window.history.pushState(this.history,'',A.baseURL()+page)}
$(window).unbind('popstate').bind('popstate',function(event){var a=window.location.href.split('/');Site.switchTo(a[a.length-1],!1,!0)})}
var menuButton=$('.menu_button_'+page);if(!menuButton.hasClass('menu_current')){menuButton.addClass('menu_current')}},setCurrentPage:function(newPage){Site.currentPage=newPage;$('.background_image').attr({src:A.baseURL()+'images/'+(Site.currentPage=='landing'?'main':Site.currentPage)+'.jpg'}).unbind('error').error(function(){$('body').css({'background-image':'url('+A.baseURL()+'images/main.jpg'+')'})}).load(function(){$('body').css({'background-image':'url('+A.baseURL()+'images/'+(Site.currentPage=='landing'?'main':Site.currentPage)+'.jpg'+')'})})},initMenu:function(current){var that=this;that.setCurrentPage(current);var menuButton=$('.menu_button_'+current);if(!menuButton.hasClass('menu_current')){menuButton.addClass('menu_current')}
var Page=that.getPageControllerName(current);A.w(['B',Page],function(){if(window[Page]&&window[Page].init){window[Page].init()}});A.w(['B'],function(){$('.menu_button').unbind('click').click(function(){var page=B.getID($(this),'menu_button_');if(page!==Site.currentPage){if(!User.data&&page=='bug'){that.scrollTo($('.header_host'),-250);D.show({title:{'you_need_to_login_at_first':{en:'Plase sign in or sign up at first',ru:'Пожалуйста, сначала войдите в систему'}},message:!1,css:D.getCss({type:'no'})})}else{that.switchTo(page,function(){that.scrollTo($('.page_content_'+page),-250)})}}
return !1})})},getDialogCSS:function(add){var css={dialog_back:{background:'rgba(0,0,0,0.8)'},message_back:{background:'url('+A.baseURL()+'/images/paper1.jpg)'},dialog_message:{'max-width':'400px',border:'none'},title:{border:'none','padding-bottom':'0px','padding-left':'20px'},buttons:{border:'none','vertical-align':'top','padding-top':'20px',width:'70px'},exit:{width:'30px',height:'30px'},exit_button_host:{width:'30px',height:'30px'},message:{'font-size':'1rem',color:'navy','text-align':'left'}};if(add){for(var i in add){if(!css[i]){css[i]={}}
for(var property in add[i]){css[i][property]=add[i][property]}}}
return css},scrollTo:function(target,offset){if(target.length){var pos=target.offset();$("html, body").animate({scrollTop:pos.top+(offset?offset:0)},300)}},click:function(obj,callback){obj.css({opacity:0.7}).unbind('mouseover').mouseover(function(){$(this).css({opacity:1})}).unbind('mouseout').mouseout(function(){$(this).css({opacity:0.7})});B.click(obj,callback)},initFileUploader:function(data){B.loadScript(A.vh2015url+'startscript/Uploader.js',function(){var get={r:'user/main',id:data.id};if(data.get){get=$.extend(get,data.get)}
get[data.obj]='upload';if(B.isIE()){$('.'+data.obj+'_uploader_host_'+data.id+'_new').css({left:'0px',position:'relative',top:'-20px',opacity:1});$('.upload_new').css({width:'150px',height:'35px'})}
Uploaders.uploaders[data.obj+'_image_'+data.id+'_']=new Uploader({host:$('.'+data.obj+'_uploader_host_'+data.id+'_new'),name:data.obj+'_image_'+data.id+'_',script:'index.php',get:get,maxsize:5*1048576,multi:!0,title:'',onRemoveOnError:function(id){if(id){$('.remove_file_host_'+id.split('file_ready_')[1]).remove()}},error:function(errors){if(!errors){return}
console.log(errors)},change:!1,previewer:!1})})},reloadImage:function(input){$('.message img').attr({src:input.image})},savedParameters:{},saveFormParameters:function(objName){var that=this;var host=$('.form_'+objName);if(host.length){that.savedParameters={};$('.input',host).each(function(){that.savedParameters[B.getID($(this),objName+'_')]=$(this).val()})}},restoreFormParameters:function(objName){var that=this;if(typeof objName=='object'){var objName=objName.object}
var host=$('.form_'+objName);for(var i in that.savedParameters){$('.'+objName+'_'+i).val(that.savedParameters[i])}
that.savedParameters={}},showImage:function(input){var that=this;that.saveFormParameters(input.obj);D.hide(function(){D.show({title:{uploaded_image_title:{en:'UPLOADED IMAGE',ru:'ЗАГРУЖЕННОЕ ИЗОБРАЖЕНИЕ'}},message:'<img src="'+input.image+'" style="width:100%; margin:auto;" alt /><div class="reload_image_host" style="width:200px;"></div>',onShow:function(){$('.add_but').css({'margin-right':'38px'});if(!input.readonly){var get={r:'user/main',id:input.id,image:input.image_id};if(input.get){get=$.extend(get,input.get)}
get[input.obj]='upload';B.loadRemote(A.vh2015url+'startscript/Uploader.js',function(){Uploaders.uploaders[input.obj+'_image_'+input.id+'_'+input.image_id]=new Uploader({host:$('.reload_image_host'),name:input.obj+'_image_'+input.id+'_'+input.image_id,script:'index.php',get:get,maxsize:5*1048576,multi:!0,title:'',onRemoveOnError:function(id){if(id){$('.remove_file_host_'+id.split('file_ready_')[1]).remove()}},onStart:function(){$('.message img').slideUp().unbind('load').load(function(){$('.message img').slideDown()})},error:function(errors){if(!errors){return}
console.log(errors)},change:!1,previewer:!1})})}},exit:function(){if(input.onExit){input.onExit(input.id)}},buttons:{upload:input.readonly?!1:{image:'images/upload.png',action:function(name){$('.file_input.id_'+input.obj+'_image_'+input.id+'_'+input.image_id).click()}},'delete':input.readonly?!1:{image:'images/del.png',action:function(name){D.hide(function(){D.show({title:{are_you_sure_to_delete_image:{en:'Are you sure you want to delete image?',ru:'Вы уверены что хотите удалить изображение?'}},message:!1,css:D.getCss({type:'no'}),exit:function(){that.showImage(input)},buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide(function(){if(input.onDelete){input.onDelete(input.id,input.image_id)}},!0,!1)}}}})})}}},cls:'dialog-asphalt'})},!0)},initImages:function(input){var that=this;var readonly=input.readonly;if(input.onUpload){that.onUpload=input.onUpload}else{that.onUpload=function(){}}
$('.image_preload').unbind('load').load(function(){$(this).parent().css({'background-image':'url('+$(this).attr('alt')+')','background-position':'cover','background-size':'100%',cursor:'pointer'}).unbind('click').click(function(){if(input.onlyPreview){return}
var image_id=B.getId($(this),'imageId_');var obj_id=B.getId($(this),'objId_');var class_name=B.getId($(this),'className_');var alwaysReadonly=$(this).hasClass('readonlyImage');if(input.click){input.click({image_id:image_id,class_name:class_name,obj_id:obj_id})}else{that.showImage({image:$('img',$(this)).attr('alt'),id:obj_id,obj:class_name,image_id:image_id,get:input.get?input.get:!1,readonly:(readonly?1:(alwaysReadonly?1:0)),onExit:input.onExit?input.onExit:!1,onDelete:input.onDelete?input.onDelete:!1})}})}).unbind('error').error(function(){$(this).parent().remove()})},contextHelpProcessor:function(host,host2){var that=this;if(!host.is(':visible')){setTimeout(function(){console.log('context wait');that.contextHelpProcessor(host,host2)},200);return}
$('.context_help',host).each(function(){var id=B.getId($(this));var obj=$('.'+id,host2?host2:host);if(obj.length&&obj.is(':visible')){$('.context_help.id_'+id,host).show()}else{$('.context_help.id_'+id,host).hide()}})},control:function(input){var that=this;if(input.obj){var input2={};for(var i in input){if(i!='obj'){input2[i]=input[i]}}
input.obj.unbind('mouseup').mouseup(function(){that.control(input2)}).unbind('keyup').keyup(function(){that.control(input2)}).unbind('change').change(function(){that.control(input2)})}
if(input.during){input.during()}
if(input.condition()){input.button.css({opacity:1}).unbind('click').click(function(){input.action()})}else{input.button.css({opacity:0.5}).unbind('click')}}};var Switchers={list:{},place:function(p){var but=new Switcher(p);this.list[but.id]=but;return but}};var Switcher=function(p){this.hide=function(){this.$.hide()}
this.show=function(){this.$.show()}
this.place=function(p){var id=p.id||Math.round(Math.random()*10000);this.host=p.host||$(document.body);this.id=id;var that=this;if($('.switcher_'+id).length){if(p.id){console.error('Object with '+id+' already present');return !1}
that.place(p);return !1}
if(!p.but||p.but.length==0){console.error('Need to set up buttons in switcher')}
this.cur=p.cur||0;this.selected=p.selected;this.but=p.but;var h=[];var w=Math.round(100/p.but.length);for(var i=0;i<p.but.length;i++){h.push('<div id="switch_'+id+'_item_'+i+'" class="'+(p.but[i].name?p.but[i].name:'')+' switch_item '+(p.unselected||'')+(i==0&&p.first?' '+p.first:'')+((i==p.but.length-1)&&p.last?' '+p.last:'')+(i==this.cur?' '+p.selected:'')+'">'+p.but[i].title+'</div>')}
p.host.html('<div class="switcher '+(p.cls||'')+'">'+h.join('')+'</div>');var that=this;$('.switch_item',this.host).unbind('mousedown').mousedown(function(){var id=$(this).attr('id').split('_item_')[1];var obj=$(this);that.switch(id)})};this.switch=function(to,noaction){if(to.split){var attr_id=$('.'+to).attr('id');if(attr_id){var id=attr_id.split('_item_')[1];var to=id}}
if(to!=this.cur){this.cur=to;if(!noaction&&this.but[to]&&this.but[to].action){this.but[to].action(to)}
$('.switch_item',this.host).removeClass(this.selected);$('#switch_'+this.id+'_item_'+to+'').addClass(this.selected)}};this.place(p)};var Units={host:document.body,templates:{ball:'<div class="pa round" style="background:red;" id="{{id}}"></div>'},types:!1,list:{},place:function(p){if(p.id&&this.list[p.id]){var unit=this.list[p.id];if(p.refresh){unit.remove();this.list[p.id]=null}else{unit.show();return unit}}
var unit=new Unit(p);this.list[unit.id]=unit;return unit},get:function(id){return this.list[id]},getMyRocket:function(){for(var i in this.list){if(this.types[this.list[i].type*1].type=='rocket'){return this.list[i]}}},outAll:function(data){console.log(data);if(Client.ignoreResponse){console.log('response ignored');return !1}else{console.log('outAll')}
var that=this;that.types=data.unittypes;if(data&&data.units){var mark_data=[];for(var i in data.units){var record=data.units[i];record.host=$('.main_field');for(var j in record.trajectories){var trajectory=record.trajectories[j];mark_data.push({x:trajectory.x0,y:trajectory.y0,color:j==0?'white':'silver'})}
mark_data.push({x:record.x,y:record.y,color:'red'});that.mark(mark_data);if(!window.transform2Dloaded){B.loadScript(A.baseURL()+'js_minified/translate2Dmin.js',function(){return that.outAll(data)});return}
Units.place(record).set(record).out()}}},mark:function(markers){for(var i in markers){var marker=markers[i];Base.appendOnce({host:$('.main_field'),html:'<div class="marker'+i+' pa" style="left:0px; top:0px; border-left:1px solid '+(marker.color?marker.color:'red')+'; border-top: 1px solid '+(marker.color?marker.color:'red')+'; display:none; width:5px; height:5px; z-index:1;"></div>',selector:'.marker'+i}).css({left:marker.x+'px',top:marker.y+'px'}).show()}
return this}};var Unit=function(p){this.interrupted=!1;this.calculate=function(){var client_time=Date.now()/1000;var contact_time=this.t_next-Client.time_offset
if(this.interrupted){return this}
if(client_time<contact_time){var dt=contact_time-client_time;var dx=this.vx*dt;var dy=this.vy*dt;var current_trajectory=this.trajectories[0];if(current_trajectory.begin*1!=this.t_next){console.error('Wrong trajectory',this)}
this.x=current_trajectory.x0-dx;this.y=current_trajectory.y0-dy}else{var choosen=!1;for(var i in this.trajectories){var trajectory=this.trajectories[i];var begin=trajectory.begin-Client.time_offset;var expired=trajectory.expired-Client.time_offset;if(client_time>=begin&&client_time<expired){var dt=client_time-begin;this.x=trajectory.x0*1+trajectory.vx*dt;this.y=trajectory.y0*1+trajectory.vy*dt;choosen=!0;break}}
if(!choosen){console.error('Trajectory is not available',this.trajectories,client_time,contact_time,this.t_next)}else{}}
return this}
this.move=function(){var that=this;setTimeout(function(){that.calculate().out().move()},50)}
this.hide=function(){this.$.hide()};this.show=function(){this.$.show()};this.remove=function(){this.$.remove()};this.command=function(com){if(com==='stop'){this.vx=0.0000001;this.vy=0;var changed=!0}
if(com==='left'&&(this.vx>0||this.vx<0.001)){this.vx=0.0000001;var changed=!0}
if(com==='right'&&(this.vx<0||this.vx<0.001)){this.vx=0.0000001;var changed=!0}
if(changed){this.interrupted=Date.now()/1000}}
this.place=function(p){if(!p.id){console.error('Unit id required');return !1}
this.host=p.host?p.host:$('.main_field');this.id=p.id;this.w=p.w?p.w:10;this.h=p.h?p.h:10;this.x=p.x*1;this.y=p.y*1;this.$=B.appendOnce({host:this.host,html:'<div class="pa round unit_'+this.id+'" style="background:'+(Units.types[p.type].type=='ball'?'white':'red')+'; left:0px; top:0px; width:10px; height:10px; display:none; border:1px solid black; z-index:0; overflow:visible;"></div>',selector:'.unit_'+this.id}).css({width:this.w+'px',height:this.h+'px'});if(p.parts){for(var j in p.parts){B.appendOnce({host:this.$,html:'<div class="pa round part_'+this.id+'_'+j+'" style="background:'+(Units.types[p.type].type=='ball'?'white':'red')+'; left:0px; top:0px; width:10px; height:10px; border:1px solid black; z-index:0;"></div>',selector:'.part_'+this.id+'_'+j}).css({width:this.w+'px',height:this.h+'px',left:p.parts[j].x+'px',top:p.parts[j].y+'px'})}}
this.move()};this.set=function(what){for(var field in what){if(field==='x'||field==='y'){this[field+'0']=what[field]}else{this[field]=what[field]}}
this.interrupted=!1;return this};this.out=function(){var that=this;var str='translateX('+(this.x-this.w/2)+'px) translateY('+(this.y-this.h/2)+'px)';A.w(['$','transform2Dloaded'],function(){that.$.css({transform:str}).fadeIn()});return this}
this.place(p)};var User={data:!1,updateBalance:function(){B.get({r:'user/main',User:'update_balance'})},init:function(){var that=this;B.get({r:'user/main',User:'profile'})},onLogout:function(){U.onLogout()},profileInit:function(input){var that=this;$('.profile_email').val(input.email);$('.profile_name').val(input.name);User.data.name=input.name;$('.username').html(User.data.name);$('.image_preview_host',$('.user_profile_page .uploaded_files_host')).remove();$('.user_profile_page .uploaded_files_host').append(input.files);that.initImages();A.w(['Site'],function(){Site.initFileUploader({obj:'User',id:input.id})});that.profileControl();$('.profile_control').unbind('keyup').keyup(function(){that.profileControl()}).unbind('mouseup').mouseup(function(){that.profileControl()}).unbind('change').change(function(){that.profileControl()});$('.user_not_confirmed_indicator').unbind('click').click(function(){that.setConfirmed({sent_to_email:$('.profile_email').val()})});$('.user_profile_page .user_avatar').unbind('click').click(function(){B.get({r:'user/main',User:'choose_avatar'})})},markEmailAsConfirmed:function(){var that=this;if($('.profile_email').length&&$('.profile_email').is(':visible')){$('.user_confirmed_indicator').show();$('.user_not_confirmed_indicator').hide();$('.profile_set_email').css({opacity:0.5}).unbind('click')}else{setTimeout(function(){that.markEmailAsConfirmed()},200)}},cleanNewPass:function(){$('.profile_pass').val('');$('.profile_repeat').val('');this.profileControl()},markEmailAsNotConfirmed:function(){var that=this;if($('.profile_email').is(':visible')){$('.user_confirmed_indicator').hide();$('.user_not_confirmed_indicator').show()}else{setTimeout(function(){that.markEmailAsNotConfirmed()},200)}},profileControl:function(){var that=this;$('.profile_control').each(function(){var id=B.getId($(this),'profile_');if($(this).val()&&$(this).val()!=$('.profile_'+id+'.default').val()&&(id!='pass'||(id=='pass'&&$('.profile_pass').val()==$('.profile_repeat').val()))){B.click($('.profile_set_'+id).css({opacity:1,cursor:'pointer'}),function(obj){var post={r:'user/main',User:'set'};post[id]=$('.profile_'+id+'.profile_control').val();if(id==='pass'||id==='email'){D.show({title:id==='pass'?{'sure_to_cahnge_the_pass':{en:'Are you sure to change the password?',ru:'Вы уверены что хотите сменить пароль?'}}:{'sure_to_cahnge_the_email':{en:'Are you sure to change email for notifications?',ru:'Вы уверены что хотите сменить email для уведомлений?'}},message:!1,css:D.getCSS({type:'norm'}),buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();B.post(post)}}}})}else{B.post(post)}})}else{$('.profile_set_'+id).css({opacity:0.5,cursor:'deafult'}).unbind('click')}})},onShow:function(){},showBalance:function(response){User.data.money=response.balance;$('.user_balance_detector').html(User.data.money+'$')},setConfirmedControl:function(input){var that=this;if($('.confirmation_code').val()){B.click($('.confirm_email').css({opacity:1,cursor:'pointer'}),function(obj){B.post({User:'confirm_email',code:$('.confirmation_code').val(),error:1});D.hide()})}else{$('.confirm_email').css({opacity:0.3,cursor:'default'}).unbind('click')}
if($('.noemail_to_set').val()){B.click($('.set_email').css({opacity:1,cursor:'pointer'}),function(obj){var email=$('.email_to_set').val();D.hide();$('.profile_email').val(email);$('.profile_email.default').val(email);B.post({r:'user/main',User:'set_email',email:email})})}else{$('.set_email').css({opacity:0.3,cursor:'default'}).unbind('click')}
if($('.email_to_set').val()){B.click($('.set_new_email').css({opacity:1,cursor:'pointer'}),function(obj){var email=$('.email_to_set').val();D.hide(function(){D.show({title:{sure_to_set_another_email_for_notifications:{en:'Are you sure to set another email for notifications?',ru:'Вы уверены что хотите задать другой email для уведомлений?'}},message:!1,css:D.getCss({type:'norm'}),exit:function(){D.hide(function(){that.setConfirmed(input)},!1,'slide')},buttons:{ok:{image:A.baseURL()+'images/go.png',action:function(){D.hide();$('.profile_email').val(email);$('.profile_email.default').val(email);B.post({r:'user/main',User:'set_email',email:email})}}}})},!1,'slide')})}else{$('.set_new_email').css({opacity:0.3,cursor:'default'}).unbind('click')}},dialog:function(input){U.dialog(input)},login:function(input){U.login(input)},setConfirmed:function(input){var that=this;if(input.confirmed_email){User.data.confirmed_email=input.confirmed_email}else if(input.sent_to_email){if($('.dialog').is(':visible')){setTimeout(function(){that.setConfirmed(input)},500)}else{that.markEmailAsNotConfirmed();D.show({title:{confirmation_email_has_sent2:{en:'Confirmation code has been sent to <span class="sent_to_email">{{email}}</span> follow the received link or enter the code below:',ru:'Код подтверждения отправлен на <span class="sent_to_email">{{email}}</span> перейдите по полученной ссылке или введите код ниже:',_include:{email:input.sent_to_email}}},message:'pages/user/confirmation.php?email='+input.sent_to_email,onShow:function(){that.setConfirmedControl(input);$('.confirmation_control').unbind('keyup').keyup(function(){that.setConfirmedControl(input)}).unbind('change').change(function(){that.setConfirmedControl(input)}).unbind('mouseup').mouseup(function(){that.setConfirmedControl(input)})},css:D.getCss({type:'norm'})})}}else{D.hide(function(){D.show({title:{no_email_detected:{en:'Please enter email address for notifications',ru:'Пожалуйста введите email адрес для уведомлений'}},message:'pages/user/noemail.php',onShow:function(){that.setConfirmedControl(input);$('.confirmation_control').unbind('keyup').keyup(function(){that.setConfirmedControl(input)}).unbind('change').change(function(){that.setConfirmedControl(input)}).unbind('mouseup').mouseup(function(){that.setConfirmedControl(input)})},css:D.getCss({type:'no'})})},!1,'slide')}},success:function(response){var that=this;User.data=response;$('.user_balance_detector').html(response.money+'$').show();B.getHTML({file:'protected/views/site/pages/user/logout.php',host:$('.user_profile_host'),cash:!0,append:!0,selector:'.user_profile',once:!0,method:'include',callback:function(){$('.username').html(User.data.name).unbind('click').click(function(){Site.switchTo('user')});$('.header_host .user_avatar').css({'background-image':"url('"+(User.data.photo.length?User.data.photo:'images/user_logo.png')+"')"}).unbind('click').click(function(){Site.switchTo('user')});$('.user_profile_host').show();$('.welcome_header_host').hide();$('.logged').show()}});$('#ulogin_receiver_container').remove();$('.ulogin-dropdown').remove();$('.menu_button_login').hide();if(that.onSuccess){that.onSuccess()}else{A.w(['Site'],function(on){if(Site.currentPage=='login'){Site.switchTo('main')}})}
O.start({r:'user/main',User:'isOnline'});setTimeout(function(){B.get({r:'user/main',User:'check_confirmed'})},500)},create:function(data){console.log(data);this.data=data},selectPartner:function(list){D.show({title:'',css:D.getCss({type:'norm'}),message:'pages/dialogs/opponents.php',onShow:function(){$('.title',$('.dialog_message')).html($('.opponents_list').attr('title'))}})},outputInviteList:function(list){if(!list){return}
var template=$('.list_element_template').html();var host=$('tbody.oppenents_list');for(var i in list){host.append(template);$('.list_template_raw',host).removeClass('list_template_raw').addClass('list_line_'+list[i].id);var line=$('.list_line_'+list[i].id);for(var k in list[i]){}}},setDialogCSS:function(){A.w(['D'],function(){D.defaultCSS.login.dialog_back='none';D.defaultCSS.login.message_back={background:'none'};D.defaultCSS.norm.message_back={background:'rgba(65,105,225,0.8)'}})},reload:function(){window.location.reload(!0)},error:function(input){D.show({title:input.message,message:!1,css:D.getCss({type:'no'}),exit:function(){D.hide(function(){if(input.callback){for(var method in input.callback){if(User[method]){User[method](input.callback[method]);break}}}},!1,'slide');}})},initImages:function(readonly){var that=this;Site.initImages({readonly:readonly?1:0,onExit:readonly?that.imageActions.onExitReadonly:that.imageActions.onExit,onDelete:that.imageActions.onDelete})},changeAvatar:function(input){User.data.photo=input.image;$('img.user_avatar').attr({src:input.image});$('div.user_avatar').css({'background-image':"url('"+input.image+"')"});$('.userpic').attr({src:input.image})},chooseAvatar:function(input){var that=this;D.show({title:{select_picture_avatar:{en:'Select image to use as avatar',ru:'Выберите изображение для аватара'}},message:'pages/user/select_avatar.php',onShow:function(){$('.for_avatar.uploaded_files_host').html(input.files);Site.initImages({click:function(data){D.hide();B.post({r:'user/main',User:'set_avatar',image_id:data.image_id*1})},onExit:function(){that.chooseAvatar()}})},css:D.getCss({type:'norm'}),buttons:{'delete':{image:A.baseURL()+'images/del.png',action:function(){D.hide();B.post({r:'user/main',User:'no_avatar'})}}}})},showUserProfile:function(input){var that=this;D.show({title:input.name,css:D.getCSS({type:'norm'}),message:input.html,onShow:function(){Site.initImages({readonly:1,onExit:function(){that.showUserProfile(input)}})}})},showImage:function(input){var that=this;if(!input.onExit){input.onExit=input.readonly?that.imageActions.onExitReadonly:that.imageActions.onExit}
if(!input.onDelete){input.onDelete=that.imageActions.onDelete}
Site.showImage(input)},outputUploadedFiles:function(input){var that=this;var host=$('.uploaded_files_host');$('.image_preview_host',host).remove();host.append(input.html);that.initImages()},onDelete:function(id){D.hide();B.get({r:'user/main',User:'profile'})},imageActions:{onDelete:function(id,image_id){B.post({r:'user/main',User:'delete_uploaded',image_id:image_id*1})},onExit:function(id){D.hide();B.get({r:'user/main',User:'profile'})},onExitReadonly:function(id){}}};var Videos={};var Video=function(p){this.loaded_frames=0;this.total_frames=0;this.current_frame=0;this.createFrame=function(frame){var res=frame<100?(frame<10?'00'+frame:'0'+frame):frame;return '<img class="frame frame_'+frame+'" style="display:none; position:absolute; left:0px; top:0px; width:295px; height:166px;" width="295" height="166" src="'+this.path+res+(this.extension||'.png')+'" alt="'+frame+'"/>'};this.load=function(input){var that=this;that.loaded_frames=0;that.total_frames=input.total_frames;var h=[];for(var i=input.total_frames-1;i>=0;i--){h.push(that.createFrame(i))}
input.host.html(h.join(''));$('.frame').unbind('error').unbind('load').load(function(){that.loaded_frames+=1;if(that.loaded_frames===that.total_frames){if(input.onComplete){input.onComplete()}}}).error(function(){console.error('error during loading frames')})};this.start=function(p){var that=this;p.host.hide();if(!p.id||!p.path){console.error('need to set up "id" for video container and "path" where sequence is stored')}
this.path=p.path;var container=Base.appendOnce({host:p.host,selector:'.video_'+p.id,html:'<div class="video_'+p.id+'"></div>'});this.frames_loaded=0;this.load({total_frames:p.total_frames,host:container,onComplete:function(){that.current_frame=0;that.delay=p.delay||40;p.host.show();if(p.onLoad){p.onLoad()}
that.play(p)}})};this.play=function(p){var that=this
$('.frame_'+that.current_frame).hide();that.current_frame+=1;$('.frame_'+that.current_frame).show();if(that.current_frame<that.total_frames){setTimeout(function(){that.play(p)},that.delay)}else{if(p.onComplete){p.onComplete()}}};this.start(p)}